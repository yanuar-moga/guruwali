<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Halaman Siswa SMPN 1 Moga</title>

<!-- XLSX Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #e8eef5;
}

/* SIDEBAR */
.sidebar {
    width: 220px;
    height: 100vh;
    position: fixed;
    background: #0d47a1;
    color: white;
    padding-top: 20px;
}

.sidebar h2 {
    text-align: center;
    font-size: 20px;
    margin-bottom: 25px;
    font-weight: bold;
}

.sidebar a {
    display: block;
    padding: 12px 20px;
    color: white;
    text-decoration: none;
    font-size: 15px;
}

.sidebar a:hover {
    background: #1565c0;
}

/* CONTENT */
.content {
    margin-left: 240px;
    padding: 20px;
}

/* BIODATA CARD */
.card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    max-width: 700px;
}

.card-header {
    display: flex;
    gap: 20px;
    align-items: center;
}

.card-header img {
    width: 120px;
    height: 150px;
    object-fit: cover;
    border-radius: 10px;
    border: 2px solid #0d47a1;
}

.data-row {
    display: flex;
    padding: 6px 0;
}

.data-label {
    width: 200px;
    font-weight: bold;
}
</style>
</head>
<body>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h3>Menu Wali Kelas</h3>
    <a href="https://yanuar-moga.github.io/guruwali/strukturkelas.html">Struktur Kelas</a>
    <a href="https://yanuar-moga.github.io/guruwali/keadaankelas.html">Keadaan Kelas</a>
    <a href="https://yanuar-moga.github.io/guruwali/walikelas.html">Wali Kelas</a>
    <a href="https://yanuar-moga.github.io/guruwali/guru.html">Guru</a>
    <a href="#">Laporan Perkembangan</a>

    <h3 style="margin-top:28px;">Menu Guru Wali</h3>
    <a href="https://yanuar-moga.github.io/guruwali/biodata.html">Profil Siswa</a>
    <a href="#">Rekap Nilai</a>
    <a href="#">Pelanggaran / Poin</a>
    <a href="#">Jadwal Konsultasi</a>

    <button onclick="logout()"
      style="margin-top:30px;background:#ff5d5d;color:#fff;border:none;padding:10px;border-radius:8px;width:100%;">
      Logout
    </button>
  </div>

<!-- CONTENT -->
<div class="content">

    <!-- BIODATA -->
    <div id="biodata" class="card">
        <h2>Biodata Siswa</h2>
        <div class="card-header">
            <img id="foto" src="">
            <div>
                <h3 id="nama"></h3>
                <div id="kelas"></div>
                <div id="nisn_display"></div>
            </div>
        </div>
        <div id="isi_biodata"></div>
    </div>

    <!-- HALAMAN LAIN -->
    <div id="curhat" class="card" style="display:none;"><h2>Curhat Siswa</h2></div>
    <div id="masalah" class="card" style="display:none;"><h2>Masalah Siswa</h2></div>
    <div id="notulen" class="card" style="display:none;"><h2>Notulen</h2></div>
    <div id="pembinaan" class="card" style="display:none;"><h2>Pembinaan</h2></div>
    <div id="pengumuman" class="card" style="display:none;"><h2>Pengumuman</h2></div>
    <div id="about" class="card" style="display:none;"><h2>Tentang Aplikasi</h2></div>

</div>

<script>
/* AMBIL NISN DARI URL */
const url = new URL(window.location.href);
const nisn_login = url.searchParams.get("nisn");

if (!nisn_login) {
    alert("Anda belum login!");
    window.location.href = "login.html";
}

/* LOAD DATA EXCEL */
async function loadData() {
    try {
        const file = "https://raw.githubusercontent.com/yanuar-moga/guruwali/main/assets/data.xlsx";
        const res = await fetch(file);
        const buf = await res.arrayBuffer();
        const wb = XLSX.read(buf, { type: "array" });
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet);

        // CARI DATA BERDASARKAN NISN
        const s = json.find(x => String(x.NISN).trim() === nisn_login.trim());

        if (!s) {
            alert("NISN tidak ditemukan di database!");
            return;
        }

        // TAMPILKAN FOTO
        const rowIndex = json.indexOf(s) + 1;
        document.getElementById("foto").src =
            `https://raw.githubusercontent.com/yanuar-moga/guruwali/main/foto/${rowIndex}.jpg`;

        // HEADER
        document.getElementById("nama").innerText = s["NAMA LENGKAP"] || "-";
        document.getElementById("kelas").innerText = "Kelas: " + (s["KELAS"] || "-");
        document.getElementById("nisn_display").innerText = "NISN: " + nisn_login;

        // DETAIL BIODATA
        const fields = [
            "NO", "NAMA PANGGIL", "JENIS KELAMIN", "Tempat Lahir", "Tgl Lahir",
            "Alamat", "No WA Siswa", "Hobi", "Cita-cita", "NIS", "Pelajaran yg disukai",
            "Pelajaran tdk disukai", "Ekskul", "Cara Belajar", "MONDOK",
            "Penerima KIP", "ADA KARTU KIP", "YATIM/PIATU"
        ];

        let html = "";
        fields.forEach(f => {
            html += `
            <div class="data-row">
                <div class="data-label">${f}</div>
                <div>: ${s[f] || "-"}</div>
            </div>`;
        });

        document.getElementById("isi_biodata").innerHTML = html;

    } catch (e) {
        alert("Gagal memuat file data.xlsx");
        console.error(e);
    }
}

loadData();

/* NAVIGASI HALAMAN */
function tampil(menu) {
    document.querySelectorAll(".card").forEach(div => div.style.display = "none");
    document.getElementById(menu).style.display = "block";
}
</script>

</body>
</html>
