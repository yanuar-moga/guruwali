<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard Guru</title>
<link rel="stylesheet" href="style.css" />
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f4f6f9;
  }
  .layout {
    display: grid;
    grid-template-columns: 240px 1fr;
    min-height: 100vh;
  }
  .sidebar {
    background: #0A4FA3;
    color: #fff;
    padding: 20px;
  }
  .sidebar h3 {
    margin-top: 0;
  }
  .sidebar a {
    color: #fff;
    text-decoration: none;
    display: block;
    padding: 8px 0;
  }
  .content {
    padding: 22px;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 6px 18px rgba(10,79,163,0.06);
    margin-bottom: 20px;
  }

  /* 3 kolom grafik */
  .grafik-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
  }

  canvas {
    width: 100% !important;
    height: 320px !important;
  }
</style>
</head>
<body>
<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h3>Menu Wali Kelas</h3>
    <a href="pengumuman.html">Pengumuman</a>
    <a href="curhatsiswa.html">Curhat Siswa</a>
    <a href="notulen.html">Notulen</a>
    <a href="#">Data Absensi</a>
    <a href="#">Laporan Perkembangan</a>

    <h3 style="margin-top:28px;">Menu Guru Wali</h3>
    <a href="#">Profil Siswa</a>
    <a href="#">Rekap Nilai</a>
    <a href="#">Pelanggaran / Poin</a>
    <a href="#">Jadwal Konsultasi</a>

    <button onclick="logout()" style="margin-top:30px;background:#ff5d5d;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;width:100%;">Logout</button>
  </div>

  <!-- MAIN CONTENT -->
  <div class="content">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:20px;">
      <img src="assets/logo.png" style="width:48px;height:48px;object-fit:contain;" />
      <div>
        <h2 style="margin:0;color:#0A4FA3">Dashboard Guru</h2>
        <div style="color:#6c7a89;">Selamat datang, Bayu</div>
      </div>
    </div>

    <!-- ============================= -->
    <!--         3 GRAFIK PIE          -->
    <!-- ============================= -->
    <div class="grafik-row">

      <div class="card">
        <h3>Grafik Jenis Kelamin</h3>
        <canvas id="chartJK"></canvas>
      </div>

      <div class="card">
        <h3>Grafik Hobi</h3>
        <canvas id="chartHobi"></canvas>
      </div>

      <div class="card">
        <h3>Grafik Cita-cita</h3>
        <canvas id="chartCita"></canvas>
      </div>

    </div>

  </div>
</div>

<!-- LIBRARY -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
function logout(){
  localStorage.removeItem('gw_ann_session_v3');
  window.location.href='index.html';
}

// ==============================
//     PALLET WARNA PIE CHART
// ==============================
const colors = [
  "#FF6384","#36A2EB","#FFCE56","#4BC0C0",
  "#9966FF","#FF9F40","#66FF66","#FF6666",
  "#6699FF","#CC66FF","#FFCC99","#99CC00"
];

// =========================================
//  LOAD FILE EXCEL & PROSES DATA OTOMATIS
// =========================================
async function loadExcel() {
  const url = "https://raw.githubusercontent.com/yanuar-moga/guruwali/main/assets/data.xlsx";

  const res = await fetch(url);
  const buf = await res.arrayBuffer();
  const wb = XLSX.read(buf, { type: "array" });

  const sheet = wb.Sheets["DATA"];
  const rows = XLSX.utils.sheet_to_json(sheet);

  let jkCount = { "Laki-laki": 0, "Perempuan": 0 };
  let hobiCount = {};
  let citaCount = {};

  rows.forEach(r => {
    let jk = r["Jenis Kelamin"] || r["JK"] || r["Gender"] || "";
    let hobi = r["Hobi"] || r["HOBI"] || "";
    let cita = r["Cita-cita"] || r["CITACITA"] || "";

    // =========== Jenis Kelamin ===========
    jk = jk.toString().trim();
    if (/l/i.test(jk)) jkCount["Laki-laki"]++;
    if (/p/i.test(jk)) jkCount["Perempuan"]++;

    // =========== Hobi (multi nilai) ===========
    if (hobi) {
      hobi.split(/[,/\\|-]/).forEach(h => {
        h = h.trim();
        if (h !== "") hobiCount[h] = (hobiCount[h] || 0) + 1;
      });
    }

    // =========== Cita-cita ===========
    if (cita) {
      cita.split(/[,/\\|-]/).forEach(c => {
        c = c.trim();
        if (c !== "") citaCount[c] = (citaCount[c] || 0) + 1;
      });
    }
  });

  renderCharts(jkCount, hobiCount, citaCount);
}

// =========================================
//          RENDER 3 PIE CHART
// =========================================
function renderCharts(jkCount, hobiCount, citaCount) {

  // === Jenis Kelamin PIE ===
  new Chart(document.getElementById("chartJK"), {
    type: "pie",
    data: {
      labels: ["Laki-laki", "Perempuan"],
      datasets: [{
        data: [jkCount["Laki-laki"], jkCount["Perempuan"]],
        backgroundColor: ["#36A2EB", "#FF6384"]
      }]
    }
  });

  // === Hobi PIE ===
  new Chart(document.getElementById("chartHobi"), {
    type: "pie",
    data: {
      labels: Object.keys(hobiCount),
      datasets: [{
        data: Object.values(hobiCount),
        backgroundColor: colors.slice(0, Object.keys(hobiCount).length)
      }]
    }
  });

  // === Cita-cita PIE ===
  new Chart(document.getElementById("chartCita"), {
    type: "pie",
    data: {
      labels: Object.keys(citaCount),
      datasets: [{
        data: Object.values(citaCount),
        backgroundColor: colors.slice(0, Object.keys(citaCount).length)
      }]
    }
  });
}

loadExcel();
</script>

</body>
</html>
