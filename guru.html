<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard Guru</title>
<link rel="stylesheet" href="style.css" />

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f4f6f9;
  }
  .layout {
    display: grid;
    grid-template-columns: 240px 1fr;
    min-height: 100vh;
  }
  .sidebar {
    background: #0A4FA3;
    color: #fff;
    padding: 20px;
  }
  .sidebar h3 {
    margin-top: 0;
  }
  .sidebar a {
    color: #fff;
    text-decoration: none;
    display: block;
    padding: 8px 0;
  }
  .content {
    padding: 22px;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 6px 18px rgba(10,79,163,0.06);
    margin-bottom: 20px;
  }

  /* === 3 GRAPH CONTAINER === */
  .chart-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
  }
  @media (max-width: 900px) {
    .chart-row {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (max-width: 600px) {
    .chart-row {
      grid-template-columns: 1fr;
    }
  }

  .chart-box {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 6px 18px rgba(10,79,163,0.06);
  }
</style>
</head>

<body>
<div class="layout">
  <!-- SIDEBAR MENU -->
  <div class="sidebar">
    <h3>Menu Wali Kelas</h3>
    <a href="pengumuman.html">Pengumuman</a>
    <a href="curhatsiswa.html">Curhat Siswa</a>
    <a href="notulen.html">Notulen</a>
    <a href="#">Data Absensi</a>
    <a href="#">Laporan Perkembangan</a>

    <h3 style="margin-top:28px;">Menu Guru Wali</h3>
    <a href="#">Profil Siswa</a>
    <a href="#">Rekap Nilai</a>
    <a href="#">Pelanggaran / Poin</a>
    <a href="#">Jadwal Konsultasi</a>

    <button onclick="logout()" style="margin-top:30px;background:#ff5d5d;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;width:100%;">Logout</button>
  </div>

  <!-- MAIN CONTENT -->
  <div class="content">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:20px;">
      <img src="assets/logo.png" style="width:48px;height:48px;object-fit:contain;" />
      <div>
        <h2 style="margin:0;color:#0A4FA3">Dashboard Guru</h2>
        <div style="color:#6c7a89;">Selamat datang, Bayu</div>
      </div>
    </div>

    <!-- 3 Grafik PIE dalam 3 kolom -->
    <div class="chart-row">
      
      <!-- Jenis Kelamin -->
      <div class="chart-box">
        <h3>Grafik Jenis Kelamin</h3>
        <canvas id="chartJK" height="180"></canvas>
      </div>

      <!-- Hobi -->
      <div class="chart-box">
        <h3>Grafik Hobi</h3>
        <canvas id="chartHobi" height="180"></canvas>
      </div>

      <!-- Cita-cita -->
      <div class="chart-box">
        <h3>Grafik Cita-cita</h3>
        <canvas id="chartCita" height="180"></canvas>
      </div>

    </div>

  </div>
</div>

<!-- XLSX + Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
function logout(){
  localStorage.removeItem('gw_ann_session_v3');
  window.location.href='index.html';
}

// ===============================
// LOAD EXCEL & GENERATE CHARTS
// ===============================
async function loadDataExcel() {

  const url = "https://raw.githubusercontent.com/yanuar-moga/guruwali/main/assets/data.xlsx";
  const res = await fetch(url);
  const buf = await res.arrayBuffer();

  const workbook = XLSX.read(buf, { type: "array" });
  const sheet = workbook.Sheets["DATA"];
  const data = XLSX.utils.sheet_to_json(sheet);

  let jkCount = { "Laki-laki": 0, "Perempuan": 0 };
  let hobiCount = {};
  let citaCount = {};

  data.forEach(row => {

    // === Jenis Kelamin (D) ===
    let jk = row["JK"] || row["Jenis Kelamin"] || row["D"];
    if (jk) {
      jk = jk.trim();
      if (jkCount[jk] !== undefined) jkCount[jk]++;
    }

    // === Hobi (J) ===
    let hobi = row["Hobi"] || "";
    if (hobi) {
      hobi.split(/[,/|-]+/).forEach(h => {
        h = h.trim();
        if (h === "") return;
        hobiCount[h] = (hobiCount[h] || 0) + 1;
      });
    }

    // === Cita-cita (K) ===
    let cita = row["Cita-cita"] || row["Citacita"] || "";
    if (cita) {
      cita.split(/[,/|-]+/).forEach(c => {
        c = c.trim();
        if (c === "") return;
        citaCount[c] = (citaCount[c] || 0) + 1;
      });
    }

  });

  renderCharts(jkCount, hobiCount, citaCount);
}


// ===============================
// RENDER GRAFIK PIE
// ===============================
function renderCharts(jkCount, hobiCount, citaCount) {

  // Limit hobi/cita Top 10
  const topHobi = Object.entries(hobiCount)
      .sort((a,b)=>b[1]-a[1]).slice(0,10);

  const topCita = Object.entries(citaCount)
      .sort((a,b)=>b[1]-a[1]).slice(0,10);

  // === Pie: Jenis Kelamin ===
  new Chart(document.getElementById("chartJK"), {
    type: "pie",
    data: {
      labels: Object.keys(jkCount),
      datasets: [{ data: Object.values(jkCount) }]
    }
  });

  // === Pie: Hobi ===
  new Chart(document.getElementById("chartHobi"), {
    type: "pie",
    data: {
      labels: topHobi.map(e => e[0]),
      datasets: [{ data: topHobi.map(e => e[1]) }]
    }
  });

  // === Pie: Cita-cita ===
  new Chart(document.getElementById("chartCita"), {
    type: "pie",
    data: {
      labels: topCita.map(e => e[0]),
      datasets: [{ data: topCita.map(e => e[1]) }]
    }
  });
}

loadDataExcel();
</script>

</body>
</html>
