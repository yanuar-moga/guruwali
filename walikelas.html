<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard Wali Kelas</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f6f9;
}
.layout {
  display: grid;
  grid-template-columns: 240px 1fr;
  min-height: 100vh;
}
.sidebar {
  background: #0A4FA3;
  color: #fff;
  padding: 20px;
}
.sidebar h3 { margin-top: 0; }
.sidebar a {
  color: #fff;
  text-decoration: none;
  display: block;
  padding: 8px 0;
}
.content { padding: 22px; }
.card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 6px 18px rgba(10,79,163,0.06);
  margin-bottom: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
table th, table td {
  padding: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
}
table th {
  background: #0A4FA3;
  color: white;
}
input {
  padding: 8px;
  width: 100%;
  margin-bottom: 10px;
}
</style>
</head>

<body>
<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h3>Menu Wali Kelas</h3>
    <a href="strukturkelas.html">Struktur Kelas</a>
    <a href="keadaankelas.html">Keadaan Kelas</a>
    <a href="walikelas.html">Wali Kelas</a>
    <a href="guru.html">Guru</a>
    <a href="#">Laporan Perkembangan</a>

    <h3 style="margin-top:28px;">Menu Guru Wali</h3>
    <a href="biodata.html">Profil Siswa</a>
    <a href="#">Rekap Nilai</a>
    <a href="#">Pelanggaran / Poin</a>
    <a href="#">Jadwal Konsultasi</a>

    <button onclick="logout()"
      style="margin-top:30px;background:#ff5d5d;color:#fff;border:none;padding:10px;border-radius:8px;width:100%;">
      Logout
    </button>
  </div>
<div class="content">

  <!-- ===== KEADAAN SISWA ===== -->
  <div class="card">
    <h3>Keadaan Siswa Kelas 7H</h3>
    <div class="stat-grid">

      <div class="stat-box">
        <h4>üë¶üëß Jumlah Siswa</h4>
        <p id="jk">Memuat...</p>
      </div>

      <div class="stat-box">
        <h4>üéÇ Klasifikasi Usia</h4>
        <p id="usia">Memuat...</p>
      </div>

      <div class="stat-box">
        <h4>üéì Pemilik KIP</h4>
        <p id="kip">Memuat...</p>
      </div>

      <div class="stat-box">
        <h4>üïäÔ∏è Yatim / Piatu</h4>
        <p id="yatim">Memuat...</p>
      </div>

    </div>
  </div>

  <script>
const URL = "https://opensheet.elk.sh/1HxpFxRiuyOehybcPh65mAtNQWrC1yi7iFZ1ZmDQnPZc/DATA";

fetch(URL)
.then(res => res.json())
.then(data => {

  let L = 0, P = 0;
  let u12 = 0, u13 = 0, u14 = 0, u15 = 0;
  let kip = 0, yatim = 0;

  data.forEach(r => {

    /* ===== JENIS KELAMIN (KOLOM D) ===== */
    const jk = (r["JENIS KELAMIN"] || "").toLowerCase().trim();
    if (jk.startsWith("l")) L++;
    if (jk.startsWith("p")) P++;

    /* ===== USIA (KOLOM G) ===== */
    const usia = Number(r["USIA"]);
    if (usia === 12) u12++;
    if (usia === 13) u13++;
    if (usia === 14) u14++;
    if (usia === 15) u15++;

    /* ===== PEMILIK KIP (KOLOM AC) ===== */
    const kipVal = (r["ADA KARTU KIP"] || "").toUpperCase().trim();
    if (kipVal === "KIP") kip++;

    /* ===== YATIM / PIATU (KOLOM AD) ===== */
    const yatimVal = (r["YATIM/PIATU"] || "").trim();
    if (yatimVal !== "") yatim++;

  });

  const total = L + P;

  document.getElementById("jk").innerHTML =
    `L: ${L} | P: ${P}<br>(Total: ${total})`;

  document.getElementById("usia").innerHTML = `
    12 th: ${u12}<br>
    13 th: ${u13}<br>
    14 th: ${u14}<br>
    15 th: ${u15}
  `;

  document.getElementById("kip").innerText = kip + " Siswa";
  document.getElementById("yatim").innerText = yatim + " Siswa";

})
.catch(err => {
  console.error(err);
  alert("Gagal memuat data Google Sheet");
});
</script>





  
  <!-- MAIN CONTENT -->
  <div class="content">

    <!-- HEADER -->
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:20px;">
      <img src="assets/logo.png" style="width:48px;height:48px;object-fit:contain;" />
      <div>
        <h2 style="margin:0;color:#0A4FA3">Dashboard Wali Kelas</h2>
        <div style="color:#6c7a89;">Data Siswa (Sheet: DATA)</div>
      </div>
    </div>

    <!-- CARD DATA -->
    <div class="card">

      <input type="text" id="search" placeholder="Cari data..." onkeyup="filterTable()">

      <table id="tabelData">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
      </table>

    </div>

  </div>
</div>

<!-- ================= GOOGLE SHEETS SCRIPT ================= -->
<script>
const sheetID = "1cSCzgeo-tD7QwDV-RUXTgb393LwyEwb9";
const sheetName = "DATA";
const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

fetch(url)
  .then(res => res.text())
  .then(text => {
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const cols = json.table.cols;
    const rows = json.table.rows;

    // Header
    let th = "<tr>";
    cols.forEach(c => th += `<th>${c.label}</th>`);
    th += "</tr>";
    document.getElementById("thead").innerHTML = th;

    // Body
    let td = "";
    rows.forEach(r => {
      td += "<tr>";
      r.c.forEach(c => {
        td += `<td>${c ? c.v : ""}</td>`;
      });
      td += "</tr>";
    });
    document.getElementById("tbody").innerHTML = td;
  });

function filterTable() {
  const input = document.getElementById("search").value.toLowerCase();
  const rows = document.querySelectorAll("#tbody tr");

  rows.forEach(row => {
    row.style.display = row.innerText.toLowerCase().includes(input) ? "" : "none";
  });
}
</script>

<!-- üîê FIREBASE AUTH ‚Äì BLOKIR BYPASS URL -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD_Dl5cdFBh_dyhkhthI2gclhWoz4ZHYls",
  authDomain: "login-2f19a.firebaseapp.com",
  projectId: "login-2f19a",
  appId: "1:751593178422:web:1d36294b46d1a954b15f97"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.replace("index.html");
  }
});
</script>

</body>
</html>
