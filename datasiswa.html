<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Siswa - Guru Wali Bayu</title>

<link rel="stylesheet" href="style.css">

<style>
body { padding-bottom: 70px; }

.toplogo {
    height: 40px !important;
    width: auto;
    object-fit: contain;
}

#clock {
    font-weight: bold;
    color: #003f7f;
}

.logout-btn {
    background: #ffd84c;
    color: #002855;
    border: none;
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.3s;
}

.logout-btn:hover { background: #ffca2c; }

.search-box {
    width: 90%;
    max-width: 500px;
    margin: 15px auto;
    display: block;
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #bbb;
}

.card {
    width: 95%;
    max-width: 1100px;
    margin: 0 auto 80px auto;
    background: white;
    border-radius: 14px;
    padding: 15px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.05);
    overflow-x: auto;
}

table { width: 100%; border-collapse: collapse; }

th, td {
    padding: 8px 10px;
    border-bottom: 1px solid #ddd;
    font-size: 14px;
}

th {
    background: #003f7f;
    color: white;
    position: sticky;
    top: 0;
}
</style>
</head>

<body class="light">

<!-- TOPBAR -->
<div class="topbar">
    <div class="top-left">
        <img src="assets/logo.png" class="toplogo">
        <h2>Data Siswa</h2>
    </div>

    <div class="top-right" style="display:flex;gap:10px;align-items:center;">
        <span id="clock">00:00:00</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</div>

<main class="menu-container">

<input type="text" id="searchBox" class="search-box" placeholder="Cari nama atau NISN...">

<div class="card">
<table id="tabelSiswa">
<thead>
<tr>
<th>No</th><th>Nama</th><th>Nama Panggil</th><th>JK</th>
<th>Tempat Lahir</th><th>Tgl Lahir</th><th>Alamat</th>
<th>WA Siswa</th><th>WA Ortu</th><th>Hobi</th><th>Cita-cita</th>
<th>NIS</th><th>NISN</th><th>Mapel Suka</th><th>Mapel Tidak Suka</th>
<th>Ekskul</th><th>Motivasi</th><th>Cara Belajar</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
</main>

<!-- SIDEBAR -->
<div class="sidebar">
<h3>Menu Wali Kelas</h3>
<a href="strukturkelas.html">Struktur Kelas</a>
<a href="keadaankelas.html">Keadaan Kelas</a>
<a href="walikelas.html">Wali Kelas</a>
<a href="guru.html">Guru</a>

<h3 style="margin-top:28px;">Menu Guru Wali</h3>
<a href="biodata.html">Profil Siswa</a>

<button onclick="logout()"
style="margin-top:30px;background:#ff5d5d;color:#fff;border:none;padding:10px;border-radius:8px;width:100%;">
Logout
</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
function updateClock(){
    document.getElementById("clock").textContent =
    new Date().toLocaleTimeString("id-ID",{hour12:false});
}
setInterval(updateClock,1000);updateClock();

function logout(){
    if(confirm("Yakin ingin logout?")){
        localStorage.removeItem("gw_ann_session_v3");
        window.location.href="index.html";
    }
}

function formatTanggalExcel(v){
    if(typeof v!=="number") return v;
    return new Date((v-25569)*86400*1000)
    .toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"});
}

async function loadSiswa(){
    const res=await fetch("https://raw.githubusercontent.com/yanuar-moga/guruwali/main/assets/data.xlsx");
    const buf=await res.arrayBuffer();
    const wb=XLSX.read(buf,{type:"array"});
    const data=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
    const tbody=document.querySelector("#tabelSiswa tbody");
    tbody.innerHTML="";
    data.forEach((r,i)=>{
        tbody.innerHTML+=`
        <tr>
        <td>${i+1}</td>
        <td>${r["NAMA LENGKAP"]}</td>
        <td>${r["NAMA PANGGIL"]}</td>
        <td>${r["JENIS KELAMIN"]}</td>
        <td>${r["Tempat Lahir"]}</td>
        <td>${formatTanggalExcel(r["Tgl Lahir"])}</td>
        <td>${r["Alamat"]}</td>
        <td>${r["No WA Siswa"]}</td>
        <td>${r["No Wa Ortu"]}</td>
        <td>${r["Hobi"]}</td>
        <td>${r["Cita-cita"]}</td>
        <td>${r["NIS"]}</td>
        <td>${r["NISN"]}</td>
        <td>${r["Pelajaran yg disukai"]}</td>
        <td>${r["Pelajaran tdk disukai"]}</td>
        <td>${r["Ekskul"]}</td>
        <td>${r["Kegiatan yg memotivasi di sekolah"]}</td>
        <td>${r["Cara Belajar"]}</td>
        </tr>`;
    });
}
loadSiswa();
</script>

<!-- ðŸ” FIREBASE AUTH PROTECTION -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD_Dl5cdFBh_dyhkhthI2gclhWoz4ZHYls",
  authDomain: "login-2f19a.firebaseapp.com",
  projectId: "login-2f19a",
  appId: "1:751593178422:web:1d36294b46d1a954b15f97"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

onAuthStateChanged(auth, user => {
  if(!user) window.location.replace("index.html");
});
</script>

</body>
</html>
