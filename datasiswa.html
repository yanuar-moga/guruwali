<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Siswa - Guru Wali Bayu</title>

<link rel="stylesheet" href="style.css">

<style>
body { padding-bottom: 70px; }

.toplogo {
    height: 40px !important;
    width: auto;
    object-fit: contain;
}

#clock {
    font-weight: bold;
    color: #003f7f;
}

.logout-btn {
    background: #ffd84c;
    color: #002855;
    border: none;
    border-radius: 8px;
    padding: 6px 10px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.3s;
}

.logout-btn:hover {
    background: #ffca2c;
}

.search-box {
    width: 90%;
    max-width: 500px;
    margin: 15px auto;
    display: block;
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid #bbb;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.card {
    width: 95%;
    max-width: 1100px;
    margin: 0 auto 80px auto;
    background: white;
    border-radius: 14px;
    padding: 15px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.05);
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 8px 10px;
    border-bottom: 1px solid #ddd;
    text-align: left;
    font-size: 14px;
}

th {
    background: #003f7f;
    color: white;
    position: sticky;
    top: 0;
}
</style>
</head>

<body class="light">

<div class="topbar">
    <div class="top-left">
        <img src="assets/logo.png" alt="Logo" class="toplogo">
        <h2>Data Siswa</h2>
    </div>

    <div class="top-right" style="display:flex;align-items:center;gap:10px;">
        <span id="clock">00:00:00</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</div>

<main class="menu-container">

    <input type="text" id="searchBox" class="search-box" placeholder="Cari nama atau NISN...">

    <div class="card">
        <table id="tabelSiswa">
            <thead>
                <tr>
                    <th>No</th>
                    <th>Nama</th>
                    <th>Nama Panggil</th>
                    <th>JK</th>
                    <th>Tempat Lahir</th>
                    <th>Tgl Lahir</th>
                    <th>Alamat</th>
                    <th>WA Siswa</th>
                    <th>WA Ortu</th>
                    <th>Hobi</th>
                    <th>Cita-cita</th>
                    <th>NIS</th>
                    <th>NISN</th>
                    <th>Mapel Suka</th>
                    <th>Mapel Tidak Suka</th>
                    <th>Ekskul</th>
                    <th>Motivasi</th>
                    <th>Cara Belajar</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</main>

<div class="navbar">
    <a href="guru.html">Beranda</a>
    <a href="pengumuman.html">Pengumuman</a>
    <a href="curhatsiswa.html">Curhat</a>
    <a href="pembinaan.html">Pembinaan</a>
    <a href="masalahsiswa.html">Masalah</a>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
function updateClock() {
    const now = new Date();
    document.getElementById("clock").textContent =
        now.toLocaleTimeString("id-ID", { hour12:false });
}
setInterval(updateClock, 1000);
updateClock();

function logout() {
    if (confirm("Yakin ingin logout?")) {
        localStorage.removeItem('gw_ann_session_v3');
        window.location.href = 'index.html';
    }
}

function formatTanggalExcel(value) {
    if (typeof value !== "number") return value;
    const date = new Date((value - 25569) * 86400 * 1000);
    return date.toLocaleDateString("id-ID", {
        day:"2-digit",
        month:"long",
        year:"numeric"
    });
}

async function loadSiswa() {
    const filePath = "https://raw.githubusercontent.com/yanuar-moga/guruwali/main/assets/data.xlsx";

    const res = await fetch(filePath);
    const buf = await res.arrayBuffer();

    const workbook = XLSX.read(buf, { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];

    const data = XLSX.utils.sheet_to_json(sheet);

    const tbody = document.querySelector("#tabelSiswa tbody");
    tbody.innerHTML = "";

    data.forEach((row, i) => {

        let nama           = row["NAMA LENGKAP"];
        let namaPanggil    = row["NAMA PANGGIL"];
        let jk             = row["JENIS KELAMIN"];
        let tempat         = row["Tempat Lahir"];
        let tgl            = formatTanggalExcel(row["Tgl Lahir"]);
        let alamat         = row["Alamat"];
        let waSiswa        = row["No WA Siswa"];
        let waOrtu         = row["No Wa Ortu"];
        let hobi           = row["Hobi"];
        let cita           = row["Cita-cita"];
        let nis            = row["NIS"];
        let nisn           = row["NISN"];
        let mapelSuka      = row["Pelajaran yg disukai"];
        let mapelTidakSuka = row["Pelajaran tdk disukai"];
        let ekskul         = row["Ekskul"];
        let motivasi       = row["Kegiatan yg memotivasi di sekolah"];
        let caraBelajar    = row["Cara Belajar"];

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${i + 1}</td>
            <td>${nama}</td>
            <td>${namaPanggil}</td>
            <td>${jk}</td>
            <td>${tempat}</td>
            <td>${tgl}</td>
            <td>${alamat}</td>
            <td>${waSiswa}</td>
            <td>${waOrtu}</td>
            <td>${hobi}</td>
            <td>${cita}</td>
            <td>${nis}</td>
            <td>${nisn}</td>
            <td>${mapelSuka}</td>
            <td>${mapelTidakSuka}</td>
            <td>${ekskul}</td>
            <td>${motivasi}</td>
            <td>${caraBelajar}</td>
        `;

        tbody.appendChild(tr);
    });
}

loadSiswa();
</script>

</body>
</html>
