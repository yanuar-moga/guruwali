<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Siswa - Guru Wali Bayu</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { padding-bottom: 70px; } /* ruang untuk navbar bawah */
    #clock { font-weight: bold; color: #003f7f; }
    .logout-btn {
      background: #ffd84c;
      color: #002855;
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }
    .logout-btn:hover { background: #ffca2c; }

    .search-box {
      width: 90%; max-width: 500px; margin: 15px auto;
      display: block; padding: 8px 10px;
      border-radius: 8px; border: 1px solid #bbb;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .card {
      width: 95%;
      max-width: 1100px;
      margin: 0 auto 80px auto;
      background: white;
      border-radius: 14px;
      padding: 15px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      font-size: 14px;
    }

    th {
      background: #003f7f;
      color: white;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    tr:hover { background: #f3f9ff; }
  </style>
</head>
<body class="light">

  <!-- ====== Topbar ====== -->
  <div class="topbar">
    <div class="top-left">
      <img src="assets/logo.png" alt="Logo" class="toplogo">
      <h2>Data Siswa</h2>
    </div>
    <div class="top-right" style="display:flex;align-items:center;gap:10px;">
      <span id="clock">00:00:00</span>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
  </div>

  <!-- ====== Konten Utama ====== -->
  <main class="menu-container">
    <input type="text" id="searchBox" class="search-box" placeholder="Cari nama atau NISN...">
    <div class="card">
      <table id="tabelSiswa">
        <thead>
          <tr>
            <th>No</th>
            <th>Nama</th>
            <th>JK</th>
            <th>NISN</th>
            <th>Tempat Lahir</th>
            <th>Tgl Lahir</th>
            <th>Agama</th>
            <th>Alamat</th>
            <th>Transportasi</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <!-- ====== Navbar Bawah (tanpa ikon, gaya sama seperti notulen) ====== -->
  <div class="navbar">
    <a href="guru.html">Beranda</a>
    <a href="pengumuman.html">Pengumuman</a>
    <a href="curhatsiswa.html">Curhat</a>
    <a href="pembinaan.html">Pembinaan</a>
    <a href="masalahsiswa.html">Masalah</a>
  </div>

  <!-- ====== Script ====== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
// Jam realtime
function updateClock() {
  const now = new Date();
  document.getElementById("clock").textContent =
    now.toLocaleTimeString("id-ID", { hour12:false });
}
setInterval(updateClock, 1000);
updateClock();

// Logout
function logout() {
  if (confirm("Yakin ingin logout?")) {
    localStorage.removeItem('gw_ann_session_v3');
    window.location.href = 'index.html';
  }
}

// Format tanggal Excel (serial)
function formatTanggalExcel(value) {
  if (typeof value !== "number") return value;
  if (value < 30000 || value > 60000) return value;

  const date = new Date((value - 25569) * 86400 * 1000);
  return date.toLocaleDateString("id-ID", { day:"2-digit", month:"long", year:"numeric" });
}

// Fungsi mencocokkan kolom Excel dengan nama tabel HTML
function ambilKolom(excelObj, ...alternatif) {
  const keys = Object.keys(excelObj).map(k => k.toLowerCase().trim());

  for (let alt of alternatif) {
    let index = keys.indexOf(alt.toLowerCase());
    if (index !== -1) return excelObj[Object.keys(excelObj)[index]];
  }

  // mode fuzzy match
  for (let key of Object.keys(excelObj)) {
    const k = key.toLowerCase();
    if (alternatif.some(a => k.includes(a.toLowerCase()))) {
      return excelObj[key];
    }
  }

  return "-";
}

// Muat data Excel langsung â†’ tampil di tabel
async function loadSiswa() {
  try {
    const filePath = "/mnt/data/data_mailmerge_foto.xlsx"; 
    const res = await fetch(filePath);
    const arrayBuffer = await res.arrayBuffer();
    const workbook = XLSX.read(arrayBuffer, { type: "array" });

    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const data = XLSX.utils.sheet_to_json(sheet);

    const tbody = document.querySelector("#tabelSiswa tbody");
    tbody.innerHTML = "";

    data.forEach((row, i) => {
      let nama = ambilKolom(row, "nama", "nama lengkap", "nama_lengkap");
      let jk = ambilKolom(row, "jk", "jenis kelamin", "gender");
      let nisn = ambilKolom(row, "nisn");
      let tempat = ambilKolom(row, "tempat lahir", "tempat_lahir", "t_lahir");
      let tgl = ambilKolom(row, "tanggal lahir", "tgl lahir", "tgl_lahir", "tanggal");
      let agama = ambilKolom(row, "agama");
      let alamat = ambilKolom(row, "alamat", "alamat rumah");
      let trans = ambilKolom(row, "transportasi", "transport");

      // Format tanggal Excel
      tgl = formatTanggalExcel(tgl);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${nama}</td>
        <td>${jk}</td>
        <td>${nisn}</td>
        <td>${tempat}</td>
        <td>${tgl}</td>
        <td>${agama}</td>
        <td>${alamat}</td>
        <td>${trans}</td>
      `;
      tbody.appendChild(tr);
    });

    // Fitur pencarian
    const searchBox = document.getElementById("searchBox");
    searchBox.addEventListener("input", () => {
      const val = searchBox.value.toLowerCase();
      const rows = tbody.getElementsByTagName("tr");

      for (let r of rows) {
        const nama = r.cells[1].textContent.toLowerCase();
        const nisn = r.cells[3].textContent.toLowerCase();
        r.style.display = (nama.includes(val) || nisn.includes(val)) ? "" : "none";
      }
    });

  } catch (err) {
    console.error("Gagal memuat data Excel:", err);
  }
}

loadSiswa();
</script>


</body>
</html>

