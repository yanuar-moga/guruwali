<script>
const sheetID = "1cSCzgeo-tD7QwDV-RUXTgb393LwyEwb9";
const sheetName = "DATA";
const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

function hitungUsia(tglLahir) {
  const today = new Date();
  const birth = new Date(tglLahir);

  let usia = today.getFullYear() - birth.getFullYear();
  const m = today.getMonth() - birth.getMonth();

  if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {
    usia--;
  }
  return usia;
}

fetch(url)
  .then(res => res.text())
  .then(text => {
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows;

    let lk = 0, pr = 0;
    let umur = {11:0,12:0,13:0,14:0,15:0};

    rows.forEach(r => {

      // === KOLOM D (Jenis Kelamin) ===
      const jk = r.c[3]?.v?.toString().toLowerCase();

      // === KOLOM F (Tanggal Lahir) ===
      const tgl = r.c[5]?.v;

      if (jk === "l" || jk === "laki-laki") lk++;
      if (jk === "p" || jk === "perempuan") pr++;

      if (tgl) {
        const usia = hitungUsia(tgl);
        if (umur[usia] !== undefined) {
          umur[usia]++;
        }
      }
    });

    // === TAMPILKAN HASIL ===
    document.getElementById("lk").innerText = lk;
    document.getElementById("pr").innerText = pr;
    document.getElementById("totalJK").innerText = lk + pr;

    document.getElementById("u11").innerText = umur[11];
    document.getElementById("u12").innerText = umur[12];
    document.getElementById("u13").innerText = umur[13];
    document.getElementById("u14").innerText = umur[14];
    document.getElementById("u15").innerText = umur[15];
    document.getElementById("totalUmur").innerText = lk + pr;
  });
</script>
