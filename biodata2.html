<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biodata Siswa</title>

<!-- XLSX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- html2canvas untuk download gambar -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<!-- jsPDF untuk PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #eef3ff;
}

.container {
    max-width: 430px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

img.foto {
    width: 130px;
    height: 170px;
    object-fit: cover;
    border: 3px solid #1f3a93;
    border-radius: 10px;
    margin-bottom: 15px;
}

.label {
    display: inline-block;
    width: 130px;
    font-weight: bold;
    color: #1f3a93;
}

p { margin: 4px 0; font-size: 15px; }

/* Navigation buttons */
.navbox {
    text-align: center;
    margin-top: 20px;
}

.navbtn {
    padding: 10px 20px;
    margin: 5px;
    background: #1f3a93;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

/* Floating Action Button (FAB) */
.fab {
    position: fixed;
    bottom: 25px;
    right: 25px;
    background: #ff5722;
    width: 63px;
    height: 63px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 30px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.fab:hover { background: #e64a19; }

.fab-menu {
    position: fixed;
    bottom: 100px;
    right: 25px;
    background: white;
    padding: 12px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    display: none;
}

.fab-menu button {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #1f3a93;
    color: white;
}
</style>
</head>
<body>

<div id="cardArea" class="container">
    <h2 style="text-align:center; margin-top:0;">Biodata Siswa</h2>

    <div style="text-align:center;">
        <img id="foto" class="foto" src="foto/default.jpg">
    </div>

    <div id="data"></div>
</div>

<div class="navbox">
    <button id="prevBtn" class="navbtn">⬅ PREV</button>
    <button id="nextBtn" class="navbtn">NEXT ➡</button>
</div>

<!-- FLOATING BUTTON -->
<div class="fab" id="fab">☰</div>

<div class="fab-menu" id="fabMenu">
    <button onclick="downloadImage()">Download Gambar</button>
    <button onclick="downloadPDF()">Download PDF Kartu Ini</button>
    <button onclick="downloadAllPDF()">Download Semua Kartu PDF</button>
</div>

<script>
let allData = [];
let index = 0;

const excelURL = "https://raw.githubusercontent.com/yanuar-moga/guruwali/main/assets/data.xlsx";

fetch(excelURL)
    .then(res => res.arrayBuffer())
    .then(buf => {
        const wb = XLSX.read(buf, { type: "array" });
        const sheet = wb.Sheets[wb.SheetNames[0]];
        allData = XLSX.utils.sheet_to_json(sheet);
        showCard();
    });

function showCard() {
    if (!allData.length) return;

    let siswa = allData[index];
    let html = "";

    document.getElementById("foto").src = `foto/${siswa.NO_ABSEN}.jpg`;
    document.getElementById("foto").onerror = function() {
        this.src = "foto/default.jpg";
    };

    for (let k in siswa) {
        html += `<p><span class="label">${k}:</span> ${siswa[k]}</p>`;
    }

    document.getElementById("data").innerHTML = html;
}

document.getElementById("nextBtn").onclick = () => {
    index = (index + 1) % allData.length;
    showCard();
};

document.getElementById("prevBtn").onclick = () => {
    index = (index - 1 + allData.length) % allData.length;
    showCard();
};

/* FAB MENU */
document.getElementById("fab").onclick = () => {
    const menu = document.getElementById("fabMenu");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
};

/* Download gambar PNG */
function downloadImage() {
    html2canvas(document.getElementById("cardArea")).then(canvas => {
        const link = document.createElement("a");
        link.download = "biodata.png";
        link.href = canvas.toDataURL();
        link.click();
    });
}

/* Download PDF kartu tampil */
function downloadPDF() {
    const { jsPDF } = window.jspdf;
    html2canvas(document.getElementById("cardArea")).then(canvas => {
        const img = canvas.toDataURL("image/png");
        const pdf = new jsPDF("p", "mm", "a4");
        pdf.addImage(img, "PNG", 10, 10, 190, 0);
        pdf.save("biodata.pdf");
    });
}

/* Download semua kartu dalam 1 PDF */
function downloadAllPDF() {
    const { jsPDF } = window.jspdf;
    let pdf = new jsPDF("p", "mm", "a4");

    let i = 0;

    function addNext() {
        if (i >= allData.length) {
            pdf.save("semua_biodata.pdf");
            return;
        }

        index = i;
        showCard();

        setTimeout(() => {
            html2canvas(document.getElementById("cardArea")).then(canvas => {
                const img = canvas.toDataURL("image/png");
                if (i > 0) pdf.addPage();
                pdf.addImage(img, "PNG", 10, 10, 190, 0);
                i++;
                addNext();
            });
        }, 300);
    }

    addNext();
}
</script>

</body>
</html>
