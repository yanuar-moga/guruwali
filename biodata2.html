<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Biodata Siswa</title>

<!-- XLSX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        margin: 0;
        padding: 0;
    }

    .container {
        width: 95%;
        max-width: 850px;
        margin: 30px auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    h2 {
        text-align: center;
        margin-bottom: 20px;
    }

    #preview {
        margin-top: 20px;
        display: none;
    }

    .foto-siswa {
        width: 150px;
        height: 200px;
        object-fit: cover;
        border: 2px solid #444;
        margin-bottom: 15px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 16px;
    }
    td {
        padding: 6px;
    }

    /* Merapikan titik dua agar sejajar */
    .label {
        width: 180px;
        font-weight: bold;
        display: inline-block;
    }

    .colon {
        width: 10px;
        display: inline-block;
    }

    #downloadBtn {
        margin-top: 20px;
        background: #2196f3;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 6px;
        cursor: pointer;
    }

    #downloadBtn:hover {
        background: #0b7dda;
    }

</style>
</head>

<body>
<div class="container">
    <h2>Biodata Siswa</h2>

    <input type="file" id="fileInput" accept=".xlsx" /><br>

    <select id="studentSelect" style="margin-top:15px; width:200px; padding:5px;">
        <option value="">Pilih Siswa</option>
    </select>

    <div id="preview">
        <img id="foto" class="foto-siswa" src="" alt="Foto Siswa">

        <table>
            <tr><td><span class="label">Nama</span><span class="colon">:</span> <span id="nama"></span></td></tr>
            <tr><td><span class="label">NISN</span><span class="colon">:</span> <span id="nisn"></span></td></tr>
            <tr><td><span class="label">NIS</span><span class="colon">:</span> <span id="nis"></span></td></tr>
            <tr><td><span class="label">Kelas</span><span class="colon">:</span> <span id="kelas"></span></td></tr>
            <tr><td><span class="label">Tempat Lahir</span><span class="colon">:</span> <span id="tempat"></span></td></tr>
            <tr><td><span class="label">Tanggal Lahir</span><span class="colon">:</span> <span id="tanggal"></span></td></tr>
            <tr><td><span class="label">Alamat</span><span class="colon">:</span> <span id="alamat"></span></td></tr>
        </table>

        <button id="downloadBtn">Download</button>
    </div>
</div>

<script>
    let siswaData = [];

    document.getElementById("fileInput").addEventListener("change", function(e) {
        const reader = new FileReader();
        reader.onload = function(evt) {
            const data = new Uint8Array(evt.target.result);
            const workbook = XLSX.read(data, { type: "array" });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            siswaData = XLSX.utils.sheet_to_json(sheet);

            const select = document.getElementById("studentSelect");
            select.innerHTML = '<option value="">Pilih Siswa</option>';

            siswaData.forEach((s, i) => {
                select.innerHTML += `<option value="${i}">${s.Nama}</option>`;
            });
        };
        reader.readAsArrayBuffer(e.target.files[0]);
    });

    document.getElementById("studentSelect").addEventListener("change", function() {
        const idx = this.value;
        if (idx === "") return;

        const s = siswaData[idx];

        document.getElementById("preview").style.display = "block";
        document.getElementById("nama").innerText = s.Nama || "";
        document.getElementById("nisn").innerText = s.NISN || "";
        document.getElementById("nis").innerText = s.NIS || "";
        document.getElementById("kelas").innerText = s.Kelas || "";
        document.getElementById("tempat").innerText = s.Tempat_Lahir || "";
        document.getElementById("tanggal").innerText = s.Tanggal_Lahir || "";
        document.getElementById("alamat").innerText = s.Alamat || "";

        // FOTO otomatis: foto/1.jpg, 2.jpg, dst
        document.getElementById("foto").src = "foto/" + (idx * 1 + 1) + ".jpg";
    });

    // DOWNLOAD Biodata
    document.getElementById("downloadBtn").onclick = function() {
        let name = document.getElementById("nama").innerText;
        let text = 
`BIODATA SISWA
Nama          : ${document.getElementById("nama").innerText}
NISN          : ${document.getElementById("nisn").innerText}
NIS           : ${document.getElementById("nis").innerText}
Kelas         : ${document.getElementById("kelas").innerText}
Tempat Lahir  : ${document.getElementById("tempat").innerText}
Tanggal Lahir : ${document.getElementById("tanggal").innerText}
Alamat        : ${document.getElementById("alamat").innerText}`;

        const blob = new Blob([text], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `${name}_biodata.txt`;
        link.click();
    };
</script>

</body>
</html>
