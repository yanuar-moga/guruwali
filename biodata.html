<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aplikasi Biodata Siswa Offline</title>

<!-- XLSX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
    body { font-family: Arial; padding: 20px; }
    #preview { border:1px solid #ccc; padding:15px; width:280px; }
    img { width: 100%; border-radius:8px; }
</style>
</head>
<body>

<h2>Aplikasi Biodata Siswa</h2>

<input type="file" id="uploadExcel" accept=".xlsx,.xls" />

<hr>

<select id="selectSiswa"></select>

<div id="preview">
    <img id="fotoSiswa" src="" alt="Foto siswa" />
    <p><b>Nama:</b> <span id="nama"></span></p>
    <p><b>NISN:</b> <span id="nisn"></span></p>
    <p><b>Kelas:</b> <span id="kelas"></span></p>
</div>

<script>
let dataSiswa = [];

// =========== BACA EXCEL ===========
document.getElementById("uploadExcel").addEventListener("change", function(e){
    const reader = new FileReader();
    reader.onload = function(e){
        const workbook = XLSX.read(e.target.result, { type: 'binary' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet);

        dataSiswa = json;
        isiDropdown();
    };
    reader.readAsBinaryString(e.target.files[0]);
});

// =========== ISI DROPDOWN ===========
function isiDropdown(){
    const sel = document.getElementById("selectSiswa");
    sel.innerHTML = "";

    dataSiswa.forEach((s, i) => {
        const opt = document.createElement("option");
        opt.value = i;           // PENTING: index = nomor urut foto
        opt.textContent = s.Nama || `Siswa ${i+1}`;
        sel.appendChild(opt);
    });

    tampilkanData(0);
}

// =========== TAMPILKAN DATA =========== 
document.getElementById("selectSiswa").addEventListener("change", function(){
    tampilkanData(this.value);
});

function tampilkanData(index){
    index = parseInt(index);

    const siswa = dataSiswa[index];
    if(!siswa) return;

    // --------------------------
    // Ganti sesuai nama kolom Excel-mu
    // --------------------------
    document.getElementById("nama").textContent  = siswa.Nama || "";
    document.getElementById("nisn").textContent  = siswa.NISN || "";
    document.getElementById("kelas").textContent = siswa.Kelas || "";

    // FOTO BERDASARKAN INDEX + 1
    const fotoURL = `https://raw.githubusercontent.com/yanuar-moga/guruwali/main/foto/${index+1}.jpg`;

    // cek apakah foto ada
    fetch(fotoURL).then(res => {
        if(res.ok){
            document.getElementById("fotoSiswa").src = fotoURL;
        } else {
            document.getElementById("fotoSiswa").src = "https://via.placeholder.com/300x400?text=No+Photo";
        }
    }).catch(err => {
        document.getElementById("fotoSiswa").src = "https://via.placeholder.com/300x400?text=No+Photo";
    });

}
</script>

</body>
</html>
