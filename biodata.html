<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biodata Siswa</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial; background:#f2f2f2; padding:20px; }
.container {
    width:420px;background:#fff;padding:20px;margin:auto;border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,.1);
}
.foto { width:120px;height:160px;object-fit:cover;border:2px solid #333;margin-bottom:10px; }
.label { font-weight:bold; display:inline-block; width:160px; }
.p-val { display:inline-block; max-width:220px; }
.nav-btn { margin-top:15px; display:flex; justify-content:space-between; }
button { padding:8px 15px; background:#007bff; color:#fff; border:none; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>

<input type="file" id="fileInput" accept=".xlsx,.xls"><br><br>
<div id="countInfo">Data: 0</div>

<div class="container" id="card">
    <h2 style="text-align:center">Biodata Siswa</h2>
    <center><img id="foto" class="foto" src=""></center>
    <div id="data"></div>

    <div class="nav-btn">
        <button onclick="prevCard()">Prev</button>
        <button onclick="nextCard()">Next</button>
    </div>
</div>

<script>
let siswa = [];
let index = 0;

// Load Excel
document.getElementById("fileInput").addEventListener("change", e => {
    let file = e.target.files[0];
    if (!file) return;

    let reader = new FileReader();
    reader.onload = evt => {
        const wb = XLSX.read(evt.target.result, { type: "binary" });
        const sheet = wb.Sheets[wb.SheetNames[0]];

        siswa = XLSX.utils.sheet_to_json(sheet, { defval: "" });
        document.getElementById("countInfo").textContent = "Data: " + siswa.length;

        if (siswa.length > 0) showCard(0);
    };
    reader.readAsBinaryString(file);
});

// Tampilkan per kartu
function showCard(i) {
    index = i;
    const s = siswa[i];

    // === LOAD FOTO BERDASARKAN INDEX BARIS ===
    const fotoFile = (i + 1) + ".jpg";
    const url = "https://raw.githubusercontent.com/yanuar-moga/guruwali/main/foto/" + fotoFile;

    const img = document.getElementById("foto");
    img.src = url;
    img.onerror = ()=> img.src = "https://via.placeholder.com/120x160?text=No+Photo";

    // === TAMPILKAN SEMUA KOLOM EXCEL APA ADANYA ===
    let html = "";
    Object.keys(s).forEach(key => {
        html += `<p><span class="label">${key}</span>: <span class="p-val">${formatValue(s[key])}</span></p>`;
    });

    document.getElementById("data").innerHTML = html;
}

// Format tanggal otomatis
function formatValue(val){
    if (typeof val === "number") {
        const date = new Date((val - 25569) * 86400 * 1000);
        return date.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});
    }
    return val;
}

function nextCard() {
    if (index < siswa.length - 1) showCard(index + 1);
}
function prevCard() {
    if (index > 0) showCard(index - 1);
}
</script>

</body>
</html>
